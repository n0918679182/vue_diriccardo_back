import{d as S,a as b,p as O,m as f,b as p,_ as $,o as a,c as d,e,n as g,t as l,w as B,v as N,r as T,F as I,f as C,g as x,h as w,i as D,j as E,k}from"./index-12a4bbba.js";const _=S("seatsMapStore",{state:()=>({seatsMap:[],tableInfoTemp:{id:0,tableId:"",customerNum:0}}),actions:{getSeatMap(){b.get("http://localhost:3000/tableState").then(t=>{this.seatsMap=t.data}).catch(t=>alert(t.response.data.message))},getTableInfo(t){this.tableInfoTemp=t},takeSeat(t,s){const i={customerNum:s,sitTime:new Date().toTimeString().substring(0,5).split(":").join(" : "),using:1};b.patch("http://localhost:3000/tableState/"+t,i).then(()=>{document.getElementById("addCloseBtn").click()}).catch(n=>alert(n.response.data.message))},async cleanTable(){await b.patch("http://localhost:3000/tableState/"+this.tableInfoTemp.id,{customerNum:0,sitTime:"",userNum:0,state:0,orderSerial:"",staffId:"",using:0}).catch(t=>alert(t.response.data.message)),this.tableInfoTemp={}}}}),y=S("orderStore",{state:()=>({allOrders:[],orderDetailTemp:{}}),actions:{getAllOrders(){b.get("http://localhost:3000/orderList/").then(t=>{this.allOrders=t.data}).catch(t=>alert(t.response.data.message))},showOrderDetail(t){let s=[];try{this.orderDetailTemp=this.allOrders.filter(n=>n.tableId===t)[0];const{allProducts:i}=O();i.forEach(n=>{this.orderDetailTemp.orders.forEach(r=>{n.id==r&&s.push(n)})}),this.orderDetailTemp.newOrders=s}catch(i){console.log("error: can't find this.orderDetailTemp",i)}},timeInChinese(t){const s=new Date(t);return`${s.getFullYear()} 年 ${s.getMonth()+1} 月 ${s.getDate()} 日 ${s.getHours()} 時 ${s.getMinutes()} 分`},async orderListToHistory(){await b.delete("http://localhost:3000/orderList/"+this.orderDetailTemp.id),this.orderDetailTemp.id="",await b.post("http://localhost:3000/historyOrders",{newOrders:this.orderDetailTemp.newOrders,orders:this.orderDetailTemp.orders,serial:this.orderDetailTemp.serial,staffId:this.orderDetailTemp.staffId,subtotal:this.orderDetailTemp.subtotal,tableId:this.orderDetailTemp.tableId,tiem:this.orderDetailTemp.time,user:this.orderDetailTemp.user}).catch(t=>alert(t.response.data.message)),this.orderDetailTemp={}}}}),A={data(){return{selectPeople:1}},computed:{...f(_,["tableInfoTemp"])},methods:{...p(_,["takeSeat"]),takeSeatAndInitSelectPeople(t,s){this.selectPeople=1,this.takeSeat(t,s)}}},L={class:"modal fade",id:"tableAddModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false","aria-labelledby":"tableAddModalLabel","aria-hidden":"true"},j={class:"modal-dialog modal-dialog-centered"},P={class:"modal-content"},V={class:"modal-title text-white",id:"tableAddModalLabel"},H=e("span",{class:"material-icons-outlined text-white",role:"button","data-bs-dismiss":"modal","aria-label":"Close",id:"addCloseBtn"}," cancel ",-1),F={class:"modal-body d-flex py-10 px-5 justify-content-center"},R=e("i",{class:"bx bx-user-circle h2 me-5 text-dark"},null,-1),z=e("option",{value:"1"},"1 位",-1),U=e("option",{value:"2"},"2 位",-1),Y=e("option",{value:"3"},"3 位",-1),q=e("option",{value:"4"},"4 位",-1),G=[z,U,Y,q],J={class:"modal-footer p-0"};function K(t,s,i,n,r,h){return a(),d("div",L,[e("div",j,[e("div",P,[e("div",{class:g(["modal-header",{"bg-primary-1":t.tableInfoTemp.colorCode==1,"bg-primary-2":t.tableInfoTemp.colorCode==2,"bg-primary-3":t.tableInfoTemp.colorCode==3,"bg-primary-4":t.tableInfoTemp.colorCode==4}])},[e("h5",V,l(t.tableInfoTemp.tableId),1),H],2),e("div",F,[R,B(e("select",{class:"form-select w-75","aria-label":"Default select example","onUpdate:modelValue":s[0]||(s[0]=c=>r.selectPeople=c)},G,512),[[N,r.selectPeople]])]),e("div",J,[e("button",{type:"button",class:"btn w-100 m-0 rounded-0 py-3 text-secondary",onClick:s[1]||(s[1]=()=>h.takeSeatAndInitSelectPeople(t.tableInfoTemp.id,r.selectPeople))},"確定")])])])])}const Q=$(A,[["render",K]]),M=S("effectStateStore",{state:()=>({orderInfoEffect:0,billBtnEffect:0}),actions:{changeOrderInfoClickEffect(){this.orderInfoEffect==0?this.orderInfoEffect=1:this.orderInfoEffect=0},changeBillBtnEffect(){this.billBtnEffect==0?this.billBtnEffect=1:this.billBtnEffect=0}}}),W={methods:{...p(y,["orderListToHistory"]),...p(_,["cleanTable"]),async resetSeat(){await this.orderListToHistory(),await this.cleanTable()}}},X={class:"modal fade",id:"resetSeatModal",tabindex:"-1","aria-labelledby":"resetSeatModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false","aria-hidden":"true"},Z={class:"modal-dialog modal-dialog-centered"},ee={class:"modal-content"},te={class:"modal-body"},se=e("p",{class:"my-5 h4 text-center"},"即將重置座位資訊！",-1),oe={class:"d-flex justify-content-center"},ae=e("button",{type:"button",class:"btn btn-outline-danger me-3","data-bs-target":"#orderInfoModal","data-bs-toggle":"modal"},"取消",-1);function de(t,s,i,n,r,h){return a(),d("div",X,[e("div",Z,[e("div",ee,[e("div",te,[se,e("div",oe,[ae,e("button",{type:"button",class:"btn btn-danger text-white",onClick:s[0]||(s[0]=(...c)=>h.resetSeat&&h.resetSeat(...c)),"data-bs-dismiss":"modal"},"確定")])])])])])}const le=$(W,[["render",de]]);const ne={computed:{...f(y,["orderDetailTemp"]),...f(M,["billBtnEffect"])},methods:{...p(y,["timeInChinese"]),...p(M,["changeBillBtnEffect"])},components:{ResetSeatModal:le}},u=t=>(D("data-v-8d7f5186"),t=t(),E(),t),ie={class:"modal fade",id:"orderInfoModal",tabindex:"-1","aria-labelledby":"orderInfoModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false","aria-hidden":"true"},re={class:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable"},ce={key:0,class:"modal-content overflow-visible"},pe={class:"modal-header align-items-start"},me={class:"d-flex flex-column"},he={class:"mb-3 text-dark h5"},be={class:"mb-3 text-dark h5"},fe={class:"m-0 h7"},_e={class:"modal-body"},ue={class:"table"},ge=u(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"餐點名稱"),e("th",{class:"text-end",scope:"col"},"價格")])],-1)),Ie={class:"fw-normal"},ye={class:"text-end"},$e={class:"modal-footer position-relative"},ve={class:"d-flex flex-column align-items-end",style:{width:"150px"}},Te={class:"d-flex justify-content-between align-items-end w-100 mb-2"},we=u(()=>e("p",{class:"mb-0 h7"},"小計：",-1)),Me={class:"mb-0 h5"},ke=u(()=>e("div",{class:"d-flex justify-content-between align-items-end w-100 mb-2"},[e("p",{class:"mb-0 h7"},"服務費："),e("p",{class:"mb-0 h7 me-1"},"10 % ")],-1)),Se={class:"d-flex justify-content-between align-items-end w-100 mb-1"},xe=u(()=>e("p",{class:"mb-0 h7"},"總計：",-1)),Ce={class:"mb-0 h5 text-danger"},De={key:1,class:"modal-content"},Ee=u(()=>e("div",{class:"modal-header"},[e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Oe=u(()=>e("div",{class:"modal-body"},[e("p",{class:"py-6 h4 text-center"},"顧客尚未送出點餐")],-1)),Be=[Ee,Oe];function Ne(t,s,i,n,r,h){const c=T("ResetSeatModal");return a(),d(I,null,[e("div",ie,[e("div",re,[t.orderDetailTemp?(a(),d("div",ce,[e("div",pe,[e("div",me,[e("p",he,"單號："+l(t.orderDetailTemp.serial),1),e("p",be,"桌號："+l(t.orderDetailTemp.tableId),1),e("p",fe,l(t.timeInChinese(t.orderDetailTemp.time)),1)]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:s[0]||(s[0]=()=>t.orderDetailTemp.subtotal=0)})]),e("div",_e,[e("table",ue,[ge,e("tbody",null,[(a(!0),d(I,null,C(t.orderDetailTemp.newOrders,(m,o)=>(a(),d("tr",{key:o},[e("th",Ie,l(m.name),1),e("td",ye,l(m.price),1)]))),128))])])]),e("div",$e,[e("div",ve,[e("div",Te,[we,e("p",Me,l(t.orderDetailTemp.subtotal),1)]),ke,e("div",Se,[xe,e("p",Ce,l(t.orderDetailTemp.subtotal+t.orderDetailTemp.subtotal*.1),1)])]),e("div",{class:g(["bg-primary-2 py-4 px-5 completeBill text-white",{click:t.billBtnEffect}]),role:"button","data-bs-toggle":"modal","data-bs-target":"#resetSeatModal",onMousedown:s[1]||(s[1]=()=>t.changeBillBtnEffect()),onMouseup:s[2]||(s[2]=()=>t.changeBillBtnEffect())}," 完成結帳",34)])])):t.orderDetailTemp?x("",!0):(a(),d("div",De,Be))])]),w(c)],64)}const Ae=$(ne,[["render",Ne],["__scopeId","data-v-8d7f5186"]]);const Le={computed:{...f(_,["tableInfoTemp"]),...f(M,["memberInfoEffect","orderInfoEffect"])},methods:{...p(M,["changeOrderInfoClickEffect"]),...p(y,["showOrderDetail"])},components:{OrderInfoModal:Ae}},v=t=>(D("data-v-c3a1cf94"),t=t(),E(),t),je={class:"modal fade",id:"tableInfoModal",tabindex:"-1","aria-labelledby":"tableInfoModalLabel","aria-hidden":"true"},Pe={class:"modal-dialog modal-dialog-centered modal-lg"},Ve={class:"modal-body py-0 px-0"},He={class:"d-flex flex-column w-100"},Fe={class:"d-flex row border-bottom mx-0"},Re={class:"col-3 d-flex justify-content-center align-items-center"},ze={class:"h1 m-0 text-white"},Ue={class:"col-6 border-start border-end py-5 px-5"},Ye={class:"mb-3 text-white"},qe={class:"h4"},Ge={class:"mb-0 text-white"},Je={class:"h4"},Ke={class:"col-3 py-2"},Qe=v(()=>e("p",{class:"text-white h7"},"狀態：",-1)),We={key:0,class:"d-flex justify-content-center align-items-center py-4"},Xe=v(()=>e("span",{class:"material-icons-outlined text-white me-3 h4"}," paid ",-1)),Ze=v(()=>e("p",{class:"text-white h4"}," 結帳 ",-1)),et=[Xe,Ze],tt={key:1,class:"d-flex justify-content-center align-items-center py-4"},st=v(()=>e("i",{class:"bx bx-user-voice text-white me-3 h4"},null,-1)),ot=v(()=>e("p",{class:"text-white h4"}," 服務鈴 ",-1)),at=[st,ot],dt={class:"d-flex w-100"};function lt(t,s,i,n,r,h){const c=T("OrderInfoModal");return a(),d(I,null,[e("div",je,[e("div",Pe,[e("div",{class:g(["modal-content rounded-0",{"bg-primary-1":t.tableInfoTemp.colorCode==1,"bg-primary-2":t.tableInfoTemp.colorCode==2,"bg-primary-3":t.tableInfoTemp.colorCode==3,"bg-primary-4":t.tableInfoTemp.colorCode==4}])},[e("div",Ve,[e("div",He,[e("div",Fe,[e("div",Re,[e("p",ze,l(t.tableInfoTemp.tableId),1)]),e("div",Ue,[e("p",Ye,[k("進場時間："),e("span",qe,l(t.tableInfoTemp.sitTime),1)]),e("p",Ge,[k("用餐人數："),e("span",Je,l(t.tableInfoTemp.customerNum)+" 位",1)])]),e("div",Ke,[Qe,t.tableInfoTemp.state==1?(a(),d("div",We,et)):t.tableInfoTemp.state==2?(a(),d("div",tt,at)):x("",!0)])]),e("div",dt,[e("a",{href:"#",class:g(["py-4 w-100 text-center text-white h5 text-decoration-none m-0",{clickEffect:t.orderInfoEffect}]),"data-bs-toggle":"modal","data-bs-target":"#orderInfoModal",onClick:s[0]||(s[0]=()=>t.showOrderDetail(t.tableInfoTemp.tableId)),onMousedown:s[1]||(s[1]=(...m)=>t.changeOrderInfoClickEffect&&t.changeOrderInfoClickEffect(...m)),onMouseup:s[2]||(s[2]=(...m)=>t.changeOrderInfoClickEffect&&t.changeOrderInfoClickEffect(...m))},"顯示點餐明細",34)])])])],2)])]),w(c)],64)}const nt=$(Le,[["render",lt],["__scopeId","data-v-c3a1cf94"]]);const it={data(){return{tableInfoTemp:{id:0,tableId:"",customerNum:0}}},computed:{...f(_,["seatsMap"])},methods:{...p(_,["getSeatMap","getTableInfo"]),...p(y,["getAllOrders"])},mounted(){setInterval(()=>{this.getSeatMap(),this.getAllOrders()},3e3)},components:{AddModal:Q,InfoModal:nt}},rt={class:"seats mt-5 py40 pe-12"},ct={class:"container w-50"},pt={class:"row"},mt={key:0,style:{height:"20px"}},ht={key:0,class:"material-icons-outlined h2 exclamationMark"},bt={class:"text-white mt-1 mx-2 mb-0"},ft=["onClick"],_t=["onClick"],ut={class:"h1 fw-bold"};function gt(t,s,i,n,r,h){const c=T("AddModal"),m=T("InfoModal");return a(),d(I,null,[e("div",rt,[e("div",ct,[e("div",pt,[(a(!0),d(I,null,C(t.seatsMap,o=>(a(),d("div",{class:"col-2 px-1 mb-2",key:o.id},[o.tableId=="path"?(a(),d("div",mt)):(a(),d("div",{key:1,class:g(["rounded-3 tablesize",{"bg-primary-1":o.customerNum>0&&o.colorCode==1,"bg-primary-2":o.customerNum>0&&o.colorCode==2,"bg-primary-3":o.customerNum>0&&o.colorCode==3,"bg-primary-4":o.customerNum>0&&o.colorCode==4}])},[o.state>0?(a(),d("span",ht," priority_high ")):x("",!0),e("p",bt,l(o.tableId),1),o.customerNum==0?(a(),d("span",{key:1,class:"material-icons-outlined text-white w-100 text-center py-3",role:"button","data-bs-toggle":"modal","data-bs-target":"#tableAddModal",onClick:()=>t.getTableInfo(o)}," add ",8,ft)):(a(),d("p",{key:2,class:"text-white m-0 w-100 text-center pt-1","data-bs-toggle":"modal",role:"button","data-bs-target":"#tableInfoModal",onClick:()=>t.getTableInfo(o)},[e("span",ut,l(o.customerNum),1),k(" 位 ")],8,_t))],2))]))),128))])])]),w(c),w(m)],64)}const yt=$(it,[["render",gt],["__scopeId","data-v-bbccb208"]]);export{yt as default};
