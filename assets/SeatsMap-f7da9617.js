import{d as C,a as f,p as L,m as b,b as r,_ as T,o as a,c as d,e,n as y,t as l,w as N,v as A,r as g,F as $,f as E,g as D,h as I,i as O,j as B,k as S}from"./index-65b05873.js";import{l as x}from"./loadingStore-040a8060.js";const _=C("seatsMapStore",{state:()=>({seatsMap:[],tableInfoTemp:{id:0,tableId:"",customerNum:0}}),actions:{getSeatMap(){f.get("https://diriccardo-server.onrender.com/tableState").then(t=>{this.seatsMap=t.data}).catch(t=>console.dir(t))},getTableInfo(t){this.tableInfoTemp=t},takeSeat(t,o){const i={customerNum:o,sitTime:new Date().toTimeString().substring(0,5).split(":").join(" : "),using:1};f.patch("https://diriccardo-server.onrender.com/tableState/"+t,i).then(()=>{document.getElementById("addCloseBtn").click()}).catch(n=>console.dir(n))},async cleanTable(){await f.patch("https://diriccardo-server.onrender.com/tableState/"+this.tableInfoTemp.id,{customerNum:0,sitTime:"",userNum:0,state:0,orderSerial:"",staffId:"",using:0}).catch(t=>console.dir(t)),this.tableInfoTemp={}}}}),v=C("orderStore",{state:()=>({allOrders:[],orderDetailTemp:{}}),actions:{getAllOrders(){f.get("https://diriccardo-server.onrender.com/orderList/").then(t=>{this.allOrders=t.data}).catch(t=>alert(t.response.data.message))},showOrderDetail(t){let o=[];try{this.orderDetailTemp=this.allOrders.filter(n=>n.tableId===t)[0];const{allProducts:i}=L();i.forEach(n=>{this.orderDetailTemp.orders.forEach(c=>{n.id==c&&o.push(n)})}),this.orderDetailTemp.newOrders=o}catch(i){console.log("error: can't find this.orderDetailTemp",i)}},timeInChinese(t){const o=new Date(t);return`${o.getFullYear()} 年 ${o.getMonth()+1} 月 ${o.getDate()} 日 ${o.getHours()} 時 ${o.getMinutes()} 分`},async orderListToHistory(){await f.delete("https://diriccardo-server.onrender.com/orderList/"+this.orderDetailTemp.id),this.orderDetailTemp.id="",await f.post("https://diriccardo-server.onrender.com/historyOrders",{newOrders:this.orderDetailTemp.newOrders,orders:this.orderDetailTemp.orders,serial:this.orderDetailTemp.serial,staffId:this.orderDetailTemp.staffId,subtotal:this.orderDetailTemp.subtotal,tableId:this.orderDetailTemp.tableId,time:this.orderDetailTemp.time,user:this.orderDetailTemp.user}).catch(t=>alert(t.response.data.message)),this.orderDetailTemp={}}}}),j={data(){return{selectPeople:1}},computed:{...b(_,["tableInfoTemp"])},methods:{...r(_,["takeSeat"]),takeSeatAndInitSelectPeople(t,o){this.selectPeople=1,this.takeSeat(t,o)}}},P={class:"modal fade",id:"tableAddModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false","aria-labelledby":"tableAddModalLabel","aria-hidden":"true"},V={class:"modal-dialog modal-dialog-centered"},H={class:"modal-content"},F={class:"modal-title text-white",id:"tableAddModalLabel"},R=e("span",{class:"material-icons-outlined text-white",role:"button","data-bs-dismiss":"modal","aria-label":"Close",id:"addCloseBtn"}," cancel ",-1),z={class:"modal-body d-flex py-10 px-5 justify-content-center"},U=e("i",{class:"bx bx-user-circle h2 me-5 text-dark"},null,-1),Y=e("option",{value:"1"},"1 位",-1),q=e("option",{value:"2"},"2 位",-1),G=e("option",{value:"3"},"3 位",-1),J=e("option",{value:"4"},"4 位",-1),K=[Y,q,G,J],Q={class:"modal-footer p-0"};function W(t,o,i,n,c,h){return a(),d("div",P,[e("div",V,[e("div",H,[e("div",{class:y(["modal-header",{"bg-primary-1":t.tableInfoTemp.colorCode==1,"bg-primary-2":t.tableInfoTemp.colorCode==2,"bg-primary-3":t.tableInfoTemp.colorCode==3,"bg-primary-4":t.tableInfoTemp.colorCode==4}])},[e("h5",F,l(t.tableInfoTemp.tableId),1),R],2),e("div",z,[U,N(e("select",{class:"form-select w-75","aria-label":"Default select example","onUpdate:modelValue":o[0]||(o[0]=m=>c.selectPeople=m)},K,512),[[A,c.selectPeople]])]),e("div",Q,[e("button",{type:"button",class:"btn w-100 m-0 rounded-0 py-3 text-secondary",onClick:o[1]||(o[1]=()=>h.takeSeatAndInitSelectPeople(t.tableInfoTemp.id,c.selectPeople))},"確定")])])])])}const X=T(j,[["render",W]]),M=C("effectStateStore",{state:()=>({orderInfoEffect:0,billBtnEffect:0}),actions:{changeOrderInfoClickEffect(){this.orderInfoEffect==0?this.orderInfoEffect=1:this.orderInfoEffect=0},changeBillBtnEffect(){this.billBtnEffect==0?this.billBtnEffect=1:this.billBtnEffect=0}}}),Z={methods:{...r(v,["orderListToHistory"]),...r(_,["cleanTable"]),async resetSeat(){await this.orderListToHistory(),await this.cleanTable()}}},ee={class:"modal fade",id:"resetSeatModal",tabindex:"-1","aria-labelledby":"resetSeatModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false","aria-hidden":"true"},te={class:"modal-dialog modal-dialog-centered"},oe={class:"modal-content"},se={class:"modal-body"},ae=e("p",{class:"my-5 h4 text-center"},"即將重置座位資訊！",-1),de={class:"d-flex justify-content-center"},le=e("button",{type:"button",class:"btn btn-outline-danger me-3","data-bs-target":"#orderInfoModal","data-bs-toggle":"modal"},"取消",-1);function ne(t,o,i,n,c,h){return a(),d("div",ee,[e("div",te,[e("div",oe,[e("div",se,[ae,e("div",de,[le,e("button",{type:"button",class:"btn btn-danger text-white",onClick:o[0]||(o[0]=(...m)=>h.resetSeat&&h.resetSeat(...m)),"data-bs-dismiss":"modal"},"確定")])])])])])}const ie=T(Z,[["render",ne]]);const re={computed:{...b(v,["orderDetailTemp"]),...b(M,["billBtnEffect"])},methods:{...r(v,["timeInChinese"]),...r(M,["changeBillBtnEffect"])},components:{ResetSeatModal:ie}},u=t=>(O("data-v-3276d45a"),t=t(),B(),t),ce={class:"modal fade",id:"orderInfoModal",tabindex:"-1","aria-labelledby":"orderInfoModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false","aria-hidden":"true"},me={class:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable"},pe={key:0,class:"modal-content overflow-visible"},he={class:"modal-header align-items-start"},be={class:"d-flex flex-column"},fe={class:"mb-3 text-dark h5"},_e={class:"mb-3 text-dark h5"},ue={class:"m-0 h7"},ge={class:"modal-body thinScrollbar"},Ie={class:"table"},ye=u(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"餐點名稱"),e("th",{class:"text-end",scope:"col"},"價格")])],-1)),$e={class:"fw-normal"},ve={class:"text-end"},Te={class:"modal-footer position-relative"},we={class:"d-flex flex-column align-items-end",style:{width:"150px"}},Me={class:"d-flex justify-content-between align-items-end w-100 mb-2"},ke=u(()=>e("p",{class:"mb-0 h7"},"小計：",-1)),Se={class:"mb-0 h5"},Ce=u(()=>e("div",{class:"d-flex justify-content-between align-items-end w-100 mb-2"},[e("p",{class:"mb-0 h7"},"服務費："),e("p",{class:"mb-0 h7 me-1"},"10 % ")],-1)),De={class:"d-flex justify-content-between align-items-end w-100 mb-1"},xe=u(()=>e("p",{class:"mb-0 h7"},"總計：",-1)),Ee={class:"mb-0 h5 text-danger"},Oe={key:1,class:"modal-content"},Be=u(()=>e("div",{class:"modal-header"},[e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Le=u(()=>e("div",{class:"modal-body"},[e("p",{class:"py-6 h4 text-center"},"顧客尚未送出點餐")],-1)),Ne=[Be,Le];function Ae(t,o,i,n,c,h){const m=g("ResetSeatModal");return a(),d($,null,[e("div",ce,[e("div",me,[t.orderDetailTemp?(a(),d("div",pe,[e("div",he,[e("div",be,[e("p",fe,"單號："+l(t.orderDetailTemp.serial),1),e("p",_e,"桌號："+l(t.orderDetailTemp.tableId),1),e("p",ue,l(t.timeInChinese(t.orderDetailTemp.time)),1)]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:o[0]||(o[0]=()=>t.orderDetailTemp.subtotal=0)})]),e("div",ge,[e("table",Ie,[ye,e("tbody",null,[(a(!0),d($,null,E(t.orderDetailTemp.newOrders,(p,k)=>(a(),d("tr",{key:k},[e("th",$e,l(p.name),1),e("td",ve,l(p.price),1)]))),128))])])]),e("div",Te,[e("div",we,[e("div",Me,[ke,e("p",Se,l(t.orderDetailTemp.subtotal),1)]),Ce,e("div",De,[xe,e("p",Ee,l(Math.round(t.orderDetailTemp.subtotal+t.orderDetailTemp.subtotal*.1)),1)])]),e("div",{class:y(["bg-primary-2 py-4 px-5 completeBill text-white",{click:t.billBtnEffect}]),role:"button","data-bs-toggle":"modal","data-bs-target":"#resetSeatModal",onMousedown:o[1]||(o[1]=()=>t.changeBillBtnEffect()),onMouseup:o[2]||(o[2]=()=>t.changeBillBtnEffect())}," 完成結帳",34)])])):t.orderDetailTemp?D("",!0):(a(),d("div",Oe,Ne))])]),I(m)],64)}const je=T(re,[["render",Ae],["__scopeId","data-v-3276d45a"]]);const Pe={computed:{...b(_,["tableInfoTemp"]),...b(M,["memberInfoEffect","orderInfoEffect"])},methods:{...r(M,["changeOrderInfoClickEffect"]),...r(v,["showOrderDetail"])},components:{OrderInfoModal:je}},w=t=>(O("data-v-c3a1cf94"),t=t(),B(),t),Ve={class:"modal fade",id:"tableInfoModal",tabindex:"-1","aria-labelledby":"tableInfoModalLabel","aria-hidden":"true"},He={class:"modal-dialog modal-dialog-centered modal-lg"},Fe={class:"modal-body py-0 px-0"},Re={class:"d-flex flex-column w-100"},ze={class:"d-flex row border-bottom mx-0"},Ue={class:"col-3 d-flex justify-content-center align-items-center"},Ye={class:"h1 m-0 text-white"},qe={class:"col-6 border-start border-end py-5 px-5"},Ge={class:"mb-3 text-white"},Je={class:"h4"},Ke={class:"mb-0 text-white"},Qe={class:"h4"},We={class:"col-3 py-2"},Xe=w(()=>e("p",{class:"text-white h7"},"狀態：",-1)),Ze={key:0,class:"d-flex justify-content-center align-items-center py-4"},et=w(()=>e("span",{class:"material-icons-outlined text-white me-3 h4"}," paid ",-1)),tt=w(()=>e("p",{class:"text-white h4"}," 結帳 ",-1)),ot=[et,tt],st={key:1,class:"d-flex justify-content-center align-items-center py-4"},at=w(()=>e("i",{class:"bx bx-user-voice text-white me-3 h4"},null,-1)),dt=w(()=>e("p",{class:"text-white h4"}," 服務鈴 ",-1)),lt=[at,dt],nt={class:"d-flex w-100"};function it(t,o,i,n,c,h){const m=g("OrderInfoModal");return a(),d($,null,[e("div",Ve,[e("div",He,[e("div",{class:y(["modal-content rounded-0",{"bg-primary-1":t.tableInfoTemp.colorCode==1,"bg-primary-2":t.tableInfoTemp.colorCode==2,"bg-primary-3":t.tableInfoTemp.colorCode==3,"bg-primary-4":t.tableInfoTemp.colorCode==4}])},[e("div",Fe,[e("div",Re,[e("div",ze,[e("div",Ue,[e("p",Ye,l(t.tableInfoTemp.tableId),1)]),e("div",qe,[e("p",Ge,[S("進場時間："),e("span",Je,l(t.tableInfoTemp.sitTime),1)]),e("p",Ke,[S("用餐人數："),e("span",Qe,l(t.tableInfoTemp.customerNum)+" 位",1)])]),e("div",We,[Xe,t.tableInfoTemp.state==1?(a(),d("div",Ze,ot)):t.tableInfoTemp.state==2?(a(),d("div",st,lt)):D("",!0)])]),e("div",nt,[e("a",{href:"#",class:y(["py-4 w-100 text-center text-white h5 text-decoration-none m-0",{clickEffect:t.orderInfoEffect}]),"data-bs-toggle":"modal","data-bs-target":"#orderInfoModal",onClick:o[0]||(o[0]=()=>t.showOrderDetail(t.tableInfoTemp.tableId)),onMousedown:o[1]||(o[1]=(...p)=>t.changeOrderInfoClickEffect&&t.changeOrderInfoClickEffect(...p)),onMouseup:o[2]||(o[2]=(...p)=>t.changeOrderInfoClickEffect&&t.changeOrderInfoClickEffect(...p))},"顯示點餐明細",34)])])])],2)])]),I(m)],64)}const rt=T(Pe,[["render",it],["__scopeId","data-v-c3a1cf94"]]);const ct={data(){return{tableInfoTemp:{id:0,tableId:"",customerNum:0}}},computed:{...b(_,["seatsMap"]),...b(x,["isLoading"])},methods:{...r(_,["getSeatMap","getTableInfo"]),...r(v,["getAllOrders"]),...r(x,["loading"])},mounted(){this.loading(),setInterval(()=>{this.getSeatMap(),this.getAllOrders()},1e3)},components:{AddModal:X,InfoModal:rt}},mt={class:"seats mt-5 py40 pe-12"},pt={class:"container w-50"},ht={class:"row"},bt={key:0,style:{height:"20px"}},ft={key:0,class:"material-icons-outlined h2 exclamationMark"},_t={class:"text-white mt-1 mx-2 mb-0"},ut=["onClick"],gt=["onClick"],It={class:"h1 fw-bold"};function yt(t,o,i,n,c,h){const m=g("VueLoading"),p=g("AddModal"),k=g("InfoModal");return a(),d($,null,[I(m,{active:t.isLoading,"onUpdate:active":o[0]||(o[0]=s=>t.isLoading=s)},null,8,["active"]),e("div",mt,[e("div",pt,[e("div",ht,[(a(!0),d($,null,E(t.seatsMap,s=>(a(),d("div",{class:"col-2 px-1 mb-2",key:s.id},[s.tableId=="path"?(a(),d("div",bt)):(a(),d("div",{key:1,class:y(["rounded-3 tablesize",{"bg-primary-1":s.customerNum>0&&s.colorCode==1,"bg-primary-2":s.customerNum>0&&s.colorCode==2,"bg-primary-3":s.customerNum>0&&s.colorCode==3,"bg-primary-4":s.customerNum>0&&s.colorCode==4}])},[s.state>0?(a(),d("span",ft," priority_high ")):D("",!0),e("p",_t,l(s.tableId),1),s.customerNum==0?(a(),d("span",{key:1,class:"material-icons-outlined text-white w-100 text-center py-3",role:"button","data-bs-toggle":"modal","data-bs-target":"#tableAddModal",onClick:()=>t.getTableInfo(s)}," add ",8,ut)):(a(),d("p",{key:2,class:"text-white m-0 w-100 text-center pt-1","data-bs-toggle":"modal",role:"button","data-bs-target":"#tableInfoModal",onClick:()=>t.getTableInfo(s)},[e("span",It,l(s.customerNum),1),S(" 位 ")],8,gt))],2))]))),128))])])]),I(p),I(k)],64)}const Tt=T(ct,[["render",yt],["__scopeId","data-v-81e2708d"]]);export{Tt as default};
